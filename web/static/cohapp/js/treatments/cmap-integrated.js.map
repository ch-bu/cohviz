{"version":3,"sources":["cmap-integrated.js"],"names":["app","CmapView","Backbone","View","extend","el","events","click #instruction-read","click #help","click #editor-button","click #editor-full-button","mouseover #editor-full-medium-editor span","mouseout #editor-full-medium-editor span","initialize","self","this","prePageDurationStart","postPageDurationStart","colors","d3","scaleOrdinal","schemeCategory10","simulations","userModel","UserSpecificModel","textModel","TextModelComplete","analyzer","TextAnalyzerModel","fetch","success","model","response","renderInstruction","error","console","log","$el","html","Handlebars","templates","instruction","get","renderEditor","Date","editor","MediumEditor","toolbar","placeholder","$","editableElement","document","querySelector","firstChild","selectElement","append","renderInstructionModal","openModal","analyzeText","regExText","text","getParagraphs","find","length","Materialize","toast","draftElapsed","set","pre_page_duration","pre_text","save","renderRevision","responseText","pre_num_sentences","pre_num_clusters","pre_num_coherent_sentences","pre_num_non_coherent_sentences","pre_num_concepts","pre_local_cohesion","paragraphs","constants","simpleRevisionModal","svgWidth","width","svgHeight","height","renderCmap","saveText","revisionElapsed","replace","post_text","post_page_duration","sendToServer","post_num_sentences","post_num_clusters","post_num_coherent_sentences","post_num_non_coherent_sentences","post_num_concepts","post_local_cohesion","location","reload","pairs","clust","numClusters","svgID","runSimulation","currentCluster","clusterIndex","mouseover","mouseOverObject","nodeSelected","mouse","g","select","id","nodeData","data","textSelected","style","svg","selectAll","d","isConnected","source","target","wordsRelated","each","push","orthos","map","obj","concat","apply","highlightSelectedWord","a","b","isConnectedAsTarget","isConnectedAsSource","index","linkedByIndex","zoomed","attr","event","transform","cluster","graph","getLinksNodes","simulation","forceSimulation","nodes","force","forceManyBody","strength","forceLink","links","distance","forceCenter","forceX","forceY","stop","call","zoom","scaleExtent","on","loading","timeout","remove","i","n","Math","ceil","alphaMin","alphaDecay","tick","link","enter","x","y","node","mouseout","paragraph","textParagraph","spanText","jquerySpan","clusters","onTextHover","e","hoveredElement","currentTarget","innerText","lemmasForWord","indexOfCluster","key","word","onTextHoverOff"],"mappings":"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","file":"cmap-integrated.js","sourcesContent":["var app = app || {};\n\n\napp.CmapView = Backbone.View.extend({\n\n    el: '#treatment-cmap-integrated',\n\n    events: {\n        'click #instruction-read': 'renderEditor',\n        'click #help': 'renderInstructionModal',\n        'click #editor-button': 'analyzeText',\n        'click #editor-full-button': 'saveText',\n        'mouseover #editor-full-medium-editor span': 'onTextHover',\n        'mouseout #editor-full-medium-editor span': 'onTextHoverOff',\n    },\n\n    initialize: function() {\n      // Variable declaration\n      var self = this;\n      this.prePageDurationStart = null;\n      this.postPageDurationStart = null;\n\n      // Generate 20 distinct colors for the cmap\n      this.colors = d3.scaleOrdinal(d3.schemeCategory10);\n\n      // this simulations\n      this.simulations = {};\n\n      // Get user data\n      this.userModel = new app.UserSpecificModel();\n\n      // Init textanalyzer model\n      this.textModel = new app.TextModelComplete();\n\n      // Init textAnalyzer model\n      this.analyzer = new app.TextAnalyzerModel();\n\n      // Fetch user data\n      this.userModel.fetch({\n          success: function(model, response) {\n              self.renderInstruction();\n          },\n          error: function(model, response) {\n              console.log(response);\n          }\n      });\n\n    },\n\n    /** Render instruction for\n      * this part of the experiment\n      */\n    renderInstruction: function() {\n      // Render instruction\n      this.$el.html(\n          Handlebars.templates.instruction({'instruction':\n              this.userModel.get('instruction')}));\n    },\n\n    /**\n     * When user has read the instruction he or she is able\n     * to write their text.\n     */\n    renderEditor: function() {\n        // Start timer for draft\n        this.prePageDurationStart = new Date();\n\n        // Render editor\n        this.$el.html(Handlebars.templates.editor());\n\n        // Enable editor functionality\n        var editor = new MediumEditor('#editor-textinput', {\n            toolbar: false,\n            placeholder: false,\n        });\n\n        // Add text to editor\n        $('#editor-textinput').html('<p>Schreibe hier ...</p>');\n\n        // Select text so that user can type instantly\n        var editableElement = document.\n            querySelector('#editor-textinput').firstChild;\n        editor.selectElement(editableElement);\n\n        // Append help button to window\n        this.$el.append('<i id=\"help\" class=\"material-icons\">help</i>');\n\n        // Append modal\n        this.$el.append(Handlebars.templates['modal-help']({'instruction':\n            this.userModel.get('instruction') }));\n    },\n\n    /**\n     * Render modal of instruction\n     */\n    renderInstructionModal: function() {\n        $('#modal-help').openModal();\n    },\n\n    /**\n     * After user has written his or her text the\n     * user gets feedback on the draft.\n     * Before users can see the feedback we need\n     * to make some sanity checks whether the\n     * text is long enough.\n     */\n    analyzeText: function() {\n        var self = this;\n\n        // Change text with major concepts\n        app.regExText('#editor-textinput');\n\n        // Get text\n        var text = app.getParagraphs(this.$el.find('#editor-textinput'));\n\n        // Check if text is long enough\n        if (text.length < 1000) {\n            // Display toast\n            Materialize.toast('Ihr Text ist leider zu kurz.', 4000);\n        } else {\n            // Stop timer for draft\n            var draftElapsed = (new Date() - this.prePageDurationStart) / 1000;\n\n            // Start timer for text revision\n            this.postPageDurationStart = new Date();\n\n            // Set draft time and draftText to textModel\n            this.textModel.set({'pre_page_duration': draftElapsed,\n                                'pre_text': text});\n\n            // Render loading ring\n            this.$el.find('#editor-button-div').html(\n                Handlebars.templates['loading-ring']());\n\n            // Get text data\n            this.analyzer.set({'text': text});\n            this.analyzer.save(null, {\n                success: function(response) {\n                    self.renderRevision();\n                },\n                error: function(model, response) {\n                    console.log(response.responseText);\n                }\n            });\n        }\n    },\n\n\n    /**\n     * After user has written the draft she gets the\n     * opportunity to revise her text\n     */\n    renderRevision: function() {\n        var self = this;\n\n        // Render submit button\n        this.$el.find('#editor-button-div').html(\n                '<a class=\"waves-effect waves-light btn\" id=\"save-text\">Text abschicken</a>');\n\n        // Save data for draft\n        this.textModel.set({'pre_text': this.analyzer.get('text'),\n            'pre_num_sentences': this.analyzer.get('numSentences'),\n            'pre_num_clusters': this.analyzer.get('numCluster'),\n            'pre_num_coherent_sentences': this.analyzer.get('cohSentences'),\n            'pre_num_non_coherent_sentences': this.analyzer.get('cohNotSentences'),\n            'pre_num_concepts': this.analyzer.get('numConcepts'),\n            'pre_local_cohesion': this.analyzer.get('local cohesion')});\n\n        // Get inner html of text input\n        this.paragraphs = $('#editor-textinput').html();\n\n        // Change inner html\n        this.$el.html(Handlebars.templates['editor-full']({'instruction':\n            app.constants.simpleRevisionModal}));\n\n        //  Append help button to window\n        this.$el.append('<i id=\"help\" class=\"material-icons\">help</i>');\n\n        // Append modal\n        this.$el.append(Handlebars.templates['modal-help']({'instruction':\n            this.userModel.get('instructionreview') }));\n\n        // Change inner html of editor\n        $('#editor-full-medium-editor').html(this.paragraphs);\n\n        // Enable editor functionality\n        var editor = new MediumEditor('#editor-full-medium-editor', {\n            toolbar: false,\n        });\n\n        // Change text of Button\n        $('#editor-full-button').text('Text abschicken');\n\n        // Display modal\n        this.$el.append(Handlebars.templates['modal-help']({'instruction':\n            this.userModel.get('instructionreview')}));\n        $('#modal-help').openModal();\n\n        // Set width of height of svg element\n        var svgWidth = $('#editor-full-graph').width();\n        var svgHeight = $('#editor-full-medium-editor').height();\n\n        // Render graph\n        this.renderCmap(this.analyzer.get('word_pairs'),\n            this.analyzer.get('clusters'), this.analyzer.get('numClusters'),\n            '#editor-full-graph', svgHeight, svgWidth, this.colors);\n    },\n\n\n    saveText: function() {\n        var self = this;\n\n        // Get seconds subject worked for revision\n        var revisionElapsed = (new Date() - this.postPageDurationStart) / 1000;\n\n        // Render loading ring\n        this.$el.find('#editor-full-button-div').html(\n            Handlebars.templates['loading-ring']());\n\n        // Get text\n        var text = app.getParagraphs(this.$el.find('#editor-full-medium-editor'));\n\n        // Remove unnecessary white spaces\n        text = text.replace(/\\s\\,/g, ',');\n        text = text.replace(/\\s\\./g, '.');\n        text = text.replace(/\\s!/g, '!');\n        text = text.replace(/\\[\\s/g, '[');\n        text = text.replace(/\\s&/g, '&');\n        text = text.replace(/\\s`/g, '`');\n        text = text.replace(/\\s~/g, '~');\n        text = text.replace(/\\s;/g, ';');\n        text = text.replace(/\\s_/g, '_');\n        text = text.replace(/\\s]/g, ']');\n        text = text.replace(/\\s:/g, ':');\n        text = text.replace(/\\s\\?/g, '?');\n        text = text.replace(/\\(\\s/g, '(');\n        text = text.replace(/\\s\\)/g, ')');\n        text = text.replace(/\\s\\//g, '/');\n\n        // Save post text to textModel\n        this.textModel.set({'post_text': text,\n                            'post_page_duration': revisionElapsed});\n\n        // Set text to analyzer\n        this.analyzer.set({'text': text});\n\n        // Fetch data\n        this.analyzer.save(null, {\n            success: function(response) {\n                self.sendToServer();\n            },\n            error: function(model, response) {\n                console.log(response.responseText);\n            }\n        });\n    },\n\n    sendToServer: function() {\n        // Save last data\n        this.textModel.set({'post_num_sentences': this.analyzer.get('numSentences'),\n            'post_num_clusters': this.analyzer.get('numCluster'),\n            'post_num_coherent_sentences': this.analyzer.get('cohSentences'),\n            'post_num_non_coherent_sentences': this.analyzer.get('cohNotSentences'),\n            'post_num_concepts': this.analyzer.get('numConcepts'),\n            'post_local_cohesion': this.analyzer.get('local cohesion')});\n\n        // Send data to server\n        this.textModel.save(null, {\n            success: function(response) {\n                // Reload page\n                location.reload();\n            },\n            error: function(model, response) {\n                console.log('error');\n            }\n        });\n    },\n\n\n    renderCmap: function(pairs, clust, numClusters, svgID, height, width, colors)  {\n      var self = this;\n      var svgHeight = height / 2;\n      var svgWidth = width / 2;\n      var margin = {top: 0, right: 0, bottom: 0, left: 0};\n\n      /**\n       * Closure\n       * @param  {[type]} currentCluster [description]\n       * @return {[type]}                [description]\n       */\n      function runSimulation(currentCluster, clusterIndex) {\n        // Save temporary cluster\n        var cluster = currentCluster;\n\n        // Get data for force simulation with\n        // nodes and links\n        var graph = app.getLinksNodes(cluster);\n\n        // Create svg\n        var svg = d3.select(svgID).append(\"svg\");\n          // .attr(\"width\", svgWidth + margin.left + margin.right)\n          // .attr(\"height\", svgHeight + margin.top + margin.bottom);\n\n        // Create force simulation\n        var simulation = d3.forceSimulation(graph.nodes)\n          .force('charge', d3.forceManyBody().strength(-240))\n          .force('link', d3.forceLink(graph.links)\n            .distance(200)\n            .id(function(d) {\n              return d.id;\n            }))\n          // .force(\"collide\", d3.forceCollide().radius(function(d) { return d.r + 1.5; }).iterations(2))\n          .force('center', d3.forceCenter(svgWidth / 2, svgHeight / 2))\n          .force('x', d3.forceX())\n          .force('y', d3.forceY())\n          .stop();\n\n        // Wrap everything in g element\n        var g = svg.append('g');\n\n        // Stores all links\n        var linkedByIndex = {};\n\n        // Call zoom\n        svg.call(d3.zoom()\n          .scaleExtent([1 / 10, 10])\n          .on('zoom', zoomed));\n\n        var loading = svg.append(\"text\")\n          .attr(\"dy\", \"0.35em\")\n          .attr(\"text-anchor\", \"middle\")\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 10)\n          .attr('x', svgWidth / 2)\n          .attr('y', svgHeight / 2)\n          .text(\"Simulating. One moment pleaseâ€¦\");\n\n        // Run simulation in the background\n        d3.timeout(function() {\n          loading.remove();\n\n          // See https://github.com/d3/d3-force/blob/master/README.md#simulation_tick\n          for (var i = 0, n = Math.ceil(Math.log(simulation.alphaMin()) / Math.log(1 - simulation.alphaDecay())); i < n; ++i) {\n            simulation.tick();\n          }\n\n          // Add links\n          var link = g.append('g')\n            .attr('class', 'links')\n            .selectAll('line')\n            .data(graph.links)\n            .enter().append('line')\n            .attr(\"x1\", function(d) { return d.source.x; })\n            .attr(\"y1\", function(d) { return d.source.y; })\n            .attr(\"x2\", function(d) { return d.target.x; })\n            .attr(\"y2\", function(d) { return d.target.y; });\n\n          link.each(function(d) {\n            linkedByIndex[d.source.index + \",\" + d.target.index] = true;\n          });\n\n          // Add data of simulation globally\n          self.simulations[clusterIndex] = {'simulation': simulation, 'linkedByIndex': linkedByIndex, 'svg': svg};\n\n          // Create g element that stores\n          // circles and text and call dragging on it\n          var node = g.append('g')\n            .attr('class', 'nodes')\n            .selectAll('.node')\n            .data(graph.nodes)\n            .enter().append('g')\n            .attr('id', function(d, i) {\n              return 'node-' + d.id;\n            })\n            .attr('class', 'node')\n            .attr('transform', function(d) {\n              return 'translate(' + d.x + ',' + d.y + ')';\n            })\n            .on('mouseover', mouseover)\n            .on('mouseout', mouseout);\n\n          // Append circle\n          var circle = node.append('circle')\n            .attr('r', 10)\n            .attr('cx', 0)\n            .attr('cy', 0)\n            .attr('fill', '#ccc');\n\n          // Append label to node container\n          var label = node.append('text')\n            .attr('dy', -10)\n            .attr('dx', 12)\n            .style('opacity', 0.8)\n            .attr('text-anchor', 'start')\n            .text(function(d) {\n              return d.id;\n            });\n        });\n\n        function mouseover(mouseOverObject) {\n          // Get data\n          var mouse = d3.mouse(this);\n\n          // Select element that is hovered\n          var nodeSelected = g.select('#node-' + mouseOverObject.id);\n          var nodeData = nodeSelected.data()[0];\n\n          // Change text of selected element\n          var textSelected = nodeSelected.select('text')\n            .style('opacity', 1)\n            .style('font-weight', 'bold');\n\n          // Highlight adjacent nodes\n          svg.selectAll('text')\n            .style('opacity', function(d) {\n             if (isConnected(nodeData, d)) {\n               return 1;\n             }\n\n             return 0.1;\n\n            });\n\n          svg.selectAll('circle')\n            .style('fill', function(d) {\n              if (isConnected(nodeData, d)) {\n                return '#000';\n              }\n\n              return '#f4f4f4';\n            })\n            .style('opacity', function(d) {\n              if (isConnected(nodeData, d)) {\n                return 1;\n              }\n\n              return 0.2;\n            });\n\n          /////////////////////\n          // Highlight links //\n          /////////////////////\n          svg.selectAll('line')\n            .style('stroke', function(d) {\n              return d.source.id === nodeData.id || d.target.id === nodeData.id ? '#4c4c4c' : '#f4f4f4';\n            });\n\n          /////////////////////////////\n          // Highlight words in text //\n          /////////////////////////////\n\n          // We need to get the text of the selected word in order\n          // to highlight them\n          var wordSelected = textSelected.text();\n\n          // Get all words that are semantically related\n          // to the selected word\n          var wordsRelated = [];\n\n          svg.selectAll('text')\n           .each(function(d) {\n             if (isConnected(nodeData, d)) {\n               wordsRelated.push(d);\n             }\n           });\n\n          // Get all words and corresponding orthoForms\n          // console.log(self.analyzer.toJSON());\n          var lemmaWordRelations = self.analyzer.get('lemmaWordRelations');\n          var orthos = wordsRelated.map(function(obj) {\n            return self.analyzer.get('lemmaWordRelations')[obj.id];\n          });\n\n          orthos = [].concat.apply([], orthos);\n\n          app.highlightSelectedWord('#editor-full-medium-editor', orthos);\n        }\n\n        function isConnected(a, b) {\n          return isConnectedAsTarget(a, b) || isConnectedAsSource(a, b) || a.index == b.index;\n        }\n\n        function isConnectedAsSource(a, b) {\n          return linkedByIndex[a.index + \",\" + b.index];\n        }\n\n        function isConnectedAsTarget(a, b) {\n          return linkedByIndex[b.index + \",\" + a.index];\n        }\n\n        function zoomed() {\n          g.attr('transform', d3.event.transform);\n        }\n      }\n\n      // Store clusters temporarily\n      var clusters = this.analyzer.get('clusters');\n\n      // Create svg for each cluster\n      for (var i = 0; i < clusters.length; i++) {\n        runSimulation(clusters[i], i);\n      }\n\n      function mouseout() {\n        $('#editor-full-medium-editor').find('p').each(function(paragraph) {\n          var textParagraph = $(this).text();\n          // Wrap everything in span elements\n          var spanText = textParagraph.replace(/([A-z0-9'<>\\u00dc\\u00fc\\u00e4\\u00c4\\u00f6\\u00d6\\u00df\\-/]+)/g, '<span>$1</span>');\n\n          var jquerySpan = $(spanText);\n\n          // Generate spans for text\n          $(this).html(jquerySpan);\n          $(this).append('.');\n        });\n\n        // Get all nodes\n        var nodes = d3.selectAll('.node');\n\n        nodes.selectAll('text')\n           .style('opacity', 0.8)\n           .style('font-weight', 'normal');\n\n        d3.selectAll('circle')\n          .style('fill', '#ccc')\n          .style('opacity', 1);\n\n        d3.selectAll('.links').selectAll('line')\n         .style('stroke', '#ccc');\n      }\n    },\n\n    onTextHover: function(e) {\n      // Get span element that is hovered\n      var hoveredElement = e.currentTarget.innerText;\n\n      // Get lemmas for word\n      var lemmasForWord = this.analyzer.get('wordLemmaRelations')[hoveredElement];\n\n      // Is element in Data?\n      if (lemmasForWord) {\n        // Get cluster of word\n\n        // Loop over every cluster and see in which cluster the word is\n        var clusters = this.analyzer.get('clusters');\n        var indexOfCluster = null;\n\n        for (var key in clusters) {\n          clusters[key].map(function(d, i) {\n            var source = d.source.word;\n            var target = d.target.word;\n\n            if (hoveredElement == source || hoveredElement == target) {\n              indexOfCluster = key;\n            }\n          });\n        }\n\n        var linkedByIndex = this.simulations[indexOfCluster].linkedByIndex;\n        var svg = this.simulations[indexOfCluster].svg;\n\n        // Get selected word\n        var nodeSelected = d3.select('#node-' + lemmasForWord[0]);\n        var nodeData = nodeSelected.data()[0];\n\n        // Change text of selected element\n        var textSelected = nodeSelected.select('text')\n          .style('opacity', 1)\n          .style('font-weight', 'bold');\n\n        // Highlight adjacent nodes\n        svg.selectAll('text')\n          .style('opacity', function(d) {\n           if (isConnected(nodeData, d)) {\n             return 1;\n           }\n\n           return 0.1;\n\n          });\n\n        svg.selectAll('circle')\n          .style('fill', function(d) {\n            if (isConnected(nodeData, d)) {\n              return '#000';\n            }\n\n            return '#f4f4f4';\n          })\n          .style('opacity', function(d) {\n            if (isConnected(nodeData, d)) {\n              return 1;\n            }\n\n            return 0.2;\n          });\n\n        /////////////////////\n        // Highlight links //\n        /////////////////////\n        svg.selectAll('line')\n          .style('stroke', function(d) {\n            return d.source.id === nodeData.id || d.target.id === nodeData.id ? '#4c4c4c' : '#f4f4f4';\n          });\n      }\n\n      function isConnected(a, b) {\n        return isConnectedAsTarget(a, b) || isConnectedAsSource(a, b) || a.index == b.index;\n      }\n\n      function isConnectedAsSource(a, b) {\n        return linkedByIndex[a.index + \",\" + b.index];\n      }\n\n      function isConnectedAsTarget(a, b) {\n        return linkedByIndex[b.index + \",\" + a.index];\n      }\n    },\n\n    onTextHoverOff: function(e) {\n      // var gElement = d3.selectAll('g');\n\n      // gElement.select('circle')\n      //   .style('fill', '#ccc');\n\n      // gElement.select('text')\n      //   .style('font-weight', 'normal');\n\n      d3.selectAll('text')\n         .style('opacity', 0.8)\n         .style('font-weight', 'normal');\n\n      d3.selectAll('circle')\n        .style('fill', '#ccc')\n        .style('opacity', 1);\n\n      d3.selectAll('.links').selectAll('line')\n       .style('stroke', '#ccc');\n    },\n\n\n});\n\nnew app.CmapView();\n\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJjbWFwLWludGVncmF0ZWQuanMiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuXG5hcHAuQ21hcFZpZXcgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG5cbiAgICBlbDogJyN0cmVhdG1lbnQtY21hcC1pbnRlZ3JhdGVkJyxcblxuICAgIGV2ZW50czoge1xuICAgICAgICAnY2xpY2sgI2luc3RydWN0aW9uLXJlYWQnOiAncmVuZGVyRWRpdG9yJyxcbiAgICAgICAgJ2NsaWNrICNoZWxwJzogJ3JlbmRlckluc3RydWN0aW9uTW9kYWwnLFxuICAgICAgICAnY2xpY2sgI2VkaXRvci1idXR0b24nOiAnYW5hbHl6ZVRleHQnLFxuICAgICAgICAnY2xpY2sgI2VkaXRvci1mdWxsLWJ1dHRvbic6ICdzYXZlVGV4dCcsXG4gICAgICAgICdtb3VzZW92ZXIgI2VkaXRvci1mdWxsLW1lZGl1bS1lZGl0b3Igc3Bhbic6ICdvblRleHRIb3ZlcicsXG4gICAgICAgICdtb3VzZW91dCAjZWRpdG9yLWZ1bGwtbWVkaXVtLWVkaXRvciBzcGFuJzogJ29uVGV4dEhvdmVyT2ZmJyxcbiAgICB9LFxuXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAvLyBWYXJpYWJsZSBkZWNsYXJhdGlvblxuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgdGhpcy5wcmVQYWdlRHVyYXRpb25TdGFydCA9IG51bGw7XG4gICAgICB0aGlzLnBvc3RQYWdlRHVyYXRpb25TdGFydCA9IG51bGw7XG5cbiAgICAgIC8vIEdlbmVyYXRlIDIwIGRpc3RpbmN0IGNvbG9ycyBmb3IgdGhlIGNtYXBcbiAgICAgIHRoaXMuY29sb3JzID0gZDMuc2NhbGVPcmRpbmFsKGQzLnNjaGVtZUNhdGVnb3J5MTApO1xuXG4gICAgICAvLyB0aGlzIHNpbXVsYXRpb25zXG4gICAgICB0aGlzLnNpbXVsYXRpb25zID0ge307XG5cbiAgICAgIC8vIEdldCB1c2VyIGRhdGFcbiAgICAgIHRoaXMudXNlck1vZGVsID0gbmV3IGFwcC5Vc2VyU3BlY2lmaWNNb2RlbCgpO1xuXG4gICAgICAvLyBJbml0IHRleHRhbmFseXplciBtb2RlbFxuICAgICAgdGhpcy50ZXh0TW9kZWwgPSBuZXcgYXBwLlRleHRNb2RlbENvbXBsZXRlKCk7XG5cbiAgICAgIC8vIEluaXQgdGV4dEFuYWx5emVyIG1vZGVsXG4gICAgICB0aGlzLmFuYWx5emVyID0gbmV3IGFwcC5UZXh0QW5hbHl6ZXJNb2RlbCgpO1xuXG4gICAgICAvLyBGZXRjaCB1c2VyIGRhdGFcbiAgICAgIHRoaXMudXNlck1vZGVsLmZldGNoKHtcbiAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihtb2RlbCwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgc2VsZi5yZW5kZXJJbnN0cnVjdGlvbigpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKG1vZGVsLCByZXNwb25zZSkge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICB9LFxuXG4gICAgLyoqIFJlbmRlciBpbnN0cnVjdGlvbiBmb3JcbiAgICAgICogdGhpcyBwYXJ0IG9mIHRoZSBleHBlcmltZW50XG4gICAgICAqL1xuICAgIHJlbmRlckluc3RydWN0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgIC8vIFJlbmRlciBpbnN0cnVjdGlvblxuICAgICAgdGhpcy4kZWwuaHRtbChcbiAgICAgICAgICBIYW5kbGViYXJzLnRlbXBsYXRlcy5pbnN0cnVjdGlvbih7J2luc3RydWN0aW9uJzpcbiAgICAgICAgICAgICAgdGhpcy51c2VyTW9kZWwuZ2V0KCdpbnN0cnVjdGlvbicpfSkpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBXaGVuIHVzZXIgaGFzIHJlYWQgdGhlIGluc3RydWN0aW9uIGhlIG9yIHNoZSBpcyBhYmxlXG4gICAgICogdG8gd3JpdGUgdGhlaXIgdGV4dC5cbiAgICAgKi9cbiAgICByZW5kZXJFZGl0b3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBTdGFydCB0aW1lciBmb3IgZHJhZnRcbiAgICAgICAgdGhpcy5wcmVQYWdlRHVyYXRpb25TdGFydCA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgLy8gUmVuZGVyIGVkaXRvclxuICAgICAgICB0aGlzLiRlbC5odG1sKEhhbmRsZWJhcnMudGVtcGxhdGVzLmVkaXRvcigpKTtcblxuICAgICAgICAvLyBFbmFibGUgZWRpdG9yIGZ1bmN0aW9uYWxpdHlcbiAgICAgICAgdmFyIGVkaXRvciA9IG5ldyBNZWRpdW1FZGl0b3IoJyNlZGl0b3ItdGV4dGlucHV0Jywge1xuICAgICAgICAgICAgdG9vbGJhcjogZmFsc2UsXG4gICAgICAgICAgICBwbGFjZWhvbGRlcjogZmFsc2UsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEFkZCB0ZXh0IHRvIGVkaXRvclxuICAgICAgICAkKCcjZWRpdG9yLXRleHRpbnB1dCcpLmh0bWwoJzxwPlNjaHJlaWJlIGhpZXIgLi4uPC9wPicpO1xuXG4gICAgICAgIC8vIFNlbGVjdCB0ZXh0IHNvIHRoYXQgdXNlciBjYW4gdHlwZSBpbnN0YW50bHlcbiAgICAgICAgdmFyIGVkaXRhYmxlRWxlbWVudCA9IGRvY3VtZW50LlxuICAgICAgICAgICAgcXVlcnlTZWxlY3RvcignI2VkaXRvci10ZXh0aW5wdXQnKS5maXJzdENoaWxkO1xuICAgICAgICBlZGl0b3Iuc2VsZWN0RWxlbWVudChlZGl0YWJsZUVsZW1lbnQpO1xuXG4gICAgICAgIC8vIEFwcGVuZCBoZWxwIGJ1dHRvbiB0byB3aW5kb3dcbiAgICAgICAgdGhpcy4kZWwuYXBwZW5kKCc8aSBpZD1cImhlbHBcIiBjbGFzcz1cIm1hdGVyaWFsLWljb25zXCI+aGVscDwvaT4nKTtcblxuICAgICAgICAvLyBBcHBlbmQgbW9kYWxcbiAgICAgICAgdGhpcy4kZWwuYXBwZW5kKEhhbmRsZWJhcnMudGVtcGxhdGVzWydtb2RhbC1oZWxwJ10oeydpbnN0cnVjdGlvbic6XG4gICAgICAgICAgICB0aGlzLnVzZXJNb2RlbC5nZXQoJ2luc3RydWN0aW9uJykgfSkpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBSZW5kZXIgbW9kYWwgb2YgaW5zdHJ1Y3Rpb25cbiAgICAgKi9cbiAgICByZW5kZXJJbnN0cnVjdGlvbk1vZGFsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgJCgnI21vZGFsLWhlbHAnKS5vcGVuTW9kYWwoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQWZ0ZXIgdXNlciBoYXMgd3JpdHRlbiBoaXMgb3IgaGVyIHRleHQgdGhlXG4gICAgICogdXNlciBnZXRzIGZlZWRiYWNrIG9uIHRoZSBkcmFmdC5cbiAgICAgKiBCZWZvcmUgdXNlcnMgY2FuIHNlZSB0aGUgZmVlZGJhY2sgd2UgbmVlZFxuICAgICAqIHRvIG1ha2Ugc29tZSBzYW5pdHkgY2hlY2tzIHdoZXRoZXIgdGhlXG4gICAgICogdGV4dCBpcyBsb25nIGVub3VnaC5cbiAgICAgKi9cbiAgICBhbmFseXplVGV4dDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAvLyBDaGFuZ2UgdGV4dCB3aXRoIG1ham9yIGNvbmNlcHRzXG4gICAgICAgIGFwcC5yZWdFeFRleHQoJyNlZGl0b3ItdGV4dGlucHV0Jyk7XG5cbiAgICAgICAgLy8gR2V0IHRleHRcbiAgICAgICAgdmFyIHRleHQgPSBhcHAuZ2V0UGFyYWdyYXBocyh0aGlzLiRlbC5maW5kKCcjZWRpdG9yLXRleHRpbnB1dCcpKTtcblxuICAgICAgICAvLyBDaGVjayBpZiB0ZXh0IGlzIGxvbmcgZW5vdWdoXG4gICAgICAgIGlmICh0ZXh0Lmxlbmd0aCA8IDEwMDApIHtcbiAgICAgICAgICAgIC8vIERpc3BsYXkgdG9hc3RcbiAgICAgICAgICAgIE1hdGVyaWFsaXplLnRvYXN0KCdJaHIgVGV4dCBpc3QgbGVpZGVyIHp1IGt1cnouJywgNDAwMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBTdG9wIHRpbWVyIGZvciBkcmFmdFxuICAgICAgICAgICAgdmFyIGRyYWZ0RWxhcHNlZCA9IChuZXcgRGF0ZSgpIC0gdGhpcy5wcmVQYWdlRHVyYXRpb25TdGFydCkgLyAxMDAwO1xuXG4gICAgICAgICAgICAvLyBTdGFydCB0aW1lciBmb3IgdGV4dCByZXZpc2lvblxuICAgICAgICAgICAgdGhpcy5wb3N0UGFnZUR1cmF0aW9uU3RhcnQgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICAgICAgICAvLyBTZXQgZHJhZnQgdGltZSBhbmQgZHJhZnRUZXh0IHRvIHRleHRNb2RlbFxuICAgICAgICAgICAgdGhpcy50ZXh0TW9kZWwuc2V0KHsncHJlX3BhZ2VfZHVyYXRpb24nOiBkcmFmdEVsYXBzZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwcmVfdGV4dCc6IHRleHR9KTtcblxuICAgICAgICAgICAgLy8gUmVuZGVyIGxvYWRpbmcgcmluZ1xuICAgICAgICAgICAgdGhpcy4kZWwuZmluZCgnI2VkaXRvci1idXR0b24tZGl2JykuaHRtbChcbiAgICAgICAgICAgICAgICBIYW5kbGViYXJzLnRlbXBsYXRlc1snbG9hZGluZy1yaW5nJ10oKSk7XG5cbiAgICAgICAgICAgIC8vIEdldCB0ZXh0IGRhdGFcbiAgICAgICAgICAgIHRoaXMuYW5hbHl6ZXIuc2V0KHsndGV4dCc6IHRleHR9KTtcbiAgICAgICAgICAgIHRoaXMuYW5hbHl6ZXIuc2F2ZShudWxsLCB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW5kZXJSZXZpc2lvbigpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKG1vZGVsLCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcblxuXG4gICAgLyoqXG4gICAgICogQWZ0ZXIgdXNlciBoYXMgd3JpdHRlbiB0aGUgZHJhZnQgc2hlIGdldHMgdGhlXG4gICAgICogb3Bwb3J0dW5pdHkgdG8gcmV2aXNlIGhlciB0ZXh0XG4gICAgICovXG4gICAgcmVuZGVyUmV2aXNpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgLy8gUmVuZGVyIHN1Ym1pdCBidXR0b25cbiAgICAgICAgdGhpcy4kZWwuZmluZCgnI2VkaXRvci1idXR0b24tZGl2JykuaHRtbChcbiAgICAgICAgICAgICAgICAnPGEgY2xhc3M9XCJ3YXZlcy1lZmZlY3Qgd2F2ZXMtbGlnaHQgYnRuXCIgaWQ9XCJzYXZlLXRleHRcIj5UZXh0IGFic2NoaWNrZW48L2E+Jyk7XG5cbiAgICAgICAgLy8gU2F2ZSBkYXRhIGZvciBkcmFmdFxuICAgICAgICB0aGlzLnRleHRNb2RlbC5zZXQoeydwcmVfdGV4dCc6IHRoaXMuYW5hbHl6ZXIuZ2V0KCd0ZXh0JyksXG4gICAgICAgICAgICAncHJlX251bV9zZW50ZW5jZXMnOiB0aGlzLmFuYWx5emVyLmdldCgnbnVtU2VudGVuY2VzJyksXG4gICAgICAgICAgICAncHJlX251bV9jbHVzdGVycyc6IHRoaXMuYW5hbHl6ZXIuZ2V0KCdudW1DbHVzdGVyJyksXG4gICAgICAgICAgICAncHJlX251bV9jb2hlcmVudF9zZW50ZW5jZXMnOiB0aGlzLmFuYWx5emVyLmdldCgnY29oU2VudGVuY2VzJyksXG4gICAgICAgICAgICAncHJlX251bV9ub25fY29oZXJlbnRfc2VudGVuY2VzJzogdGhpcy5hbmFseXplci5nZXQoJ2NvaE5vdFNlbnRlbmNlcycpLFxuICAgICAgICAgICAgJ3ByZV9udW1fY29uY2VwdHMnOiB0aGlzLmFuYWx5emVyLmdldCgnbnVtQ29uY2VwdHMnKSxcbiAgICAgICAgICAgICdwcmVfbG9jYWxfY29oZXNpb24nOiB0aGlzLmFuYWx5emVyLmdldCgnbG9jYWwgY29oZXNpb24nKX0pO1xuXG4gICAgICAgIC8vIEdldCBpbm5lciBodG1sIG9mIHRleHQgaW5wdXRcbiAgICAgICAgdGhpcy5wYXJhZ3JhcGhzID0gJCgnI2VkaXRvci10ZXh0aW5wdXQnKS5odG1sKCk7XG5cbiAgICAgICAgLy8gQ2hhbmdlIGlubmVyIGh0bWxcbiAgICAgICAgdGhpcy4kZWwuaHRtbChIYW5kbGViYXJzLnRlbXBsYXRlc1snZWRpdG9yLWZ1bGwnXSh7J2luc3RydWN0aW9uJzpcbiAgICAgICAgICAgIGFwcC5jb25zdGFudHMuc2ltcGxlUmV2aXNpb25Nb2RhbH0pKTtcblxuICAgICAgICAvLyAgQXBwZW5kIGhlbHAgYnV0dG9uIHRvIHdpbmRvd1xuICAgICAgICB0aGlzLiRlbC5hcHBlbmQoJzxpIGlkPVwiaGVscFwiIGNsYXNzPVwibWF0ZXJpYWwtaWNvbnNcIj5oZWxwPC9pPicpO1xuXG4gICAgICAgIC8vIEFwcGVuZCBtb2RhbFxuICAgICAgICB0aGlzLiRlbC5hcHBlbmQoSGFuZGxlYmFycy50ZW1wbGF0ZXNbJ21vZGFsLWhlbHAnXSh7J2luc3RydWN0aW9uJzpcbiAgICAgICAgICAgIHRoaXMudXNlck1vZGVsLmdldCgnaW5zdHJ1Y3Rpb25yZXZpZXcnKSB9KSk7XG5cbiAgICAgICAgLy8gQ2hhbmdlIGlubmVyIGh0bWwgb2YgZWRpdG9yXG4gICAgICAgICQoJyNlZGl0b3ItZnVsbC1tZWRpdW0tZWRpdG9yJykuaHRtbCh0aGlzLnBhcmFncmFwaHMpO1xuXG4gICAgICAgIC8vIEVuYWJsZSBlZGl0b3IgZnVuY3Rpb25hbGl0eVxuICAgICAgICB2YXIgZWRpdG9yID0gbmV3IE1lZGl1bUVkaXRvcignI2VkaXRvci1mdWxsLW1lZGl1bS1lZGl0b3InLCB7XG4gICAgICAgICAgICB0b29sYmFyOiBmYWxzZSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQ2hhbmdlIHRleHQgb2YgQnV0dG9uXG4gICAgICAgICQoJyNlZGl0b3ItZnVsbC1idXR0b24nKS50ZXh0KCdUZXh0IGFic2NoaWNrZW4nKTtcblxuICAgICAgICAvLyBEaXNwbGF5IG1vZGFsXG4gICAgICAgIHRoaXMuJGVsLmFwcGVuZChIYW5kbGViYXJzLnRlbXBsYXRlc1snbW9kYWwtaGVscCddKHsnaW5zdHJ1Y3Rpb24nOlxuICAgICAgICAgICAgdGhpcy51c2VyTW9kZWwuZ2V0KCdpbnN0cnVjdGlvbnJldmlldycpfSkpO1xuICAgICAgICAkKCcjbW9kYWwtaGVscCcpLm9wZW5Nb2RhbCgpO1xuXG4gICAgICAgIC8vIFNldCB3aWR0aCBvZiBoZWlnaHQgb2Ygc3ZnIGVsZW1lbnRcbiAgICAgICAgdmFyIHN2Z1dpZHRoID0gJCgnI2VkaXRvci1mdWxsLWdyYXBoJykud2lkdGgoKTtcbiAgICAgICAgdmFyIHN2Z0hlaWdodCA9ICQoJyNlZGl0b3ItZnVsbC1tZWRpdW0tZWRpdG9yJykuaGVpZ2h0KCk7XG5cbiAgICAgICAgLy8gUmVuZGVyIGdyYXBoXG4gICAgICAgIHRoaXMucmVuZGVyQ21hcCh0aGlzLmFuYWx5emVyLmdldCgnd29yZF9wYWlycycpLFxuICAgICAgICAgICAgdGhpcy5hbmFseXplci5nZXQoJ2NsdXN0ZXJzJyksIHRoaXMuYW5hbHl6ZXIuZ2V0KCdudW1DbHVzdGVycycpLFxuICAgICAgICAgICAgJyNlZGl0b3ItZnVsbC1ncmFwaCcsIHN2Z0hlaWdodCwgc3ZnV2lkdGgsIHRoaXMuY29sb3JzKTtcbiAgICB9LFxuXG5cbiAgICBzYXZlVGV4dDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAvLyBHZXQgc2Vjb25kcyBzdWJqZWN0IHdvcmtlZCBmb3IgcmV2aXNpb25cbiAgICAgICAgdmFyIHJldmlzaW9uRWxhcHNlZCA9IChuZXcgRGF0ZSgpIC0gdGhpcy5wb3N0UGFnZUR1cmF0aW9uU3RhcnQpIC8gMTAwMDtcblxuICAgICAgICAvLyBSZW5kZXIgbG9hZGluZyByaW5nXG4gICAgICAgIHRoaXMuJGVsLmZpbmQoJyNlZGl0b3ItZnVsbC1idXR0b24tZGl2JykuaHRtbChcbiAgICAgICAgICAgIEhhbmRsZWJhcnMudGVtcGxhdGVzWydsb2FkaW5nLXJpbmcnXSgpKTtcblxuICAgICAgICAvLyBHZXQgdGV4dFxuICAgICAgICB2YXIgdGV4dCA9IGFwcC5nZXRQYXJhZ3JhcGhzKHRoaXMuJGVsLmZpbmQoJyNlZGl0b3ItZnVsbC1tZWRpdW0tZWRpdG9yJykpO1xuXG4gICAgICAgIC8vIFJlbW92ZSB1bm5lY2Vzc2FyeSB3aGl0ZSBzcGFjZXNcbiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXFxzXFwsL2csICcsJyk7XG4gICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xcc1xcLi9nLCAnLicpO1xuICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXHMhL2csICchJyk7XG4gICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xcW1xccy9nLCAnWycpO1xuICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXHMmL2csICcmJyk7XG4gICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xcc2AvZywgJ2AnKTtcbiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXFxzfi9nLCAnficpO1xuICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXHM7L2csICc7Jyk7XG4gICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xcc18vZywgJ18nKTtcbiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXFxzXS9nLCAnXScpO1xuICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXHM6L2csICc6Jyk7XG4gICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xcc1xcPy9nLCAnPycpO1xuICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXChcXHMvZywgJygnKTtcbiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXFxzXFwpL2csICcpJyk7XG4gICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xcc1xcLy9nLCAnLycpO1xuXG4gICAgICAgIC8vIFNhdmUgcG9zdCB0ZXh0IHRvIHRleHRNb2RlbFxuICAgICAgICB0aGlzLnRleHRNb2RlbC5zZXQoeydwb3N0X3RleHQnOiB0ZXh0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwb3N0X3BhZ2VfZHVyYXRpb24nOiByZXZpc2lvbkVsYXBzZWR9KTtcblxuICAgICAgICAvLyBTZXQgdGV4dCB0byBhbmFseXplclxuICAgICAgICB0aGlzLmFuYWx5emVyLnNldCh7J3RleHQnOiB0ZXh0fSk7XG5cbiAgICAgICAgLy8gRmV0Y2ggZGF0YVxuICAgICAgICB0aGlzLmFuYWx5emVyLnNhdmUobnVsbCwge1xuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnNlbmRUb1NlcnZlcigpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbihtb2RlbCwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgc2VuZFRvU2VydmVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gU2F2ZSBsYXN0IGRhdGFcbiAgICAgICAgdGhpcy50ZXh0TW9kZWwuc2V0KHsncG9zdF9udW1fc2VudGVuY2VzJzogdGhpcy5hbmFseXplci5nZXQoJ251bVNlbnRlbmNlcycpLFxuICAgICAgICAgICAgJ3Bvc3RfbnVtX2NsdXN0ZXJzJzogdGhpcy5hbmFseXplci5nZXQoJ251bUNsdXN0ZXInKSxcbiAgICAgICAgICAgICdwb3N0X251bV9jb2hlcmVudF9zZW50ZW5jZXMnOiB0aGlzLmFuYWx5emVyLmdldCgnY29oU2VudGVuY2VzJyksXG4gICAgICAgICAgICAncG9zdF9udW1fbm9uX2NvaGVyZW50X3NlbnRlbmNlcyc6IHRoaXMuYW5hbHl6ZXIuZ2V0KCdjb2hOb3RTZW50ZW5jZXMnKSxcbiAgICAgICAgICAgICdwb3N0X251bV9jb25jZXB0cyc6IHRoaXMuYW5hbHl6ZXIuZ2V0KCdudW1Db25jZXB0cycpLFxuICAgICAgICAgICAgJ3Bvc3RfbG9jYWxfY29oZXNpb24nOiB0aGlzLmFuYWx5emVyLmdldCgnbG9jYWwgY29oZXNpb24nKX0pO1xuXG4gICAgICAgIC8vIFNlbmQgZGF0YSB0byBzZXJ2ZXJcbiAgICAgICAgdGhpcy50ZXh0TW9kZWwuc2F2ZShudWxsLCB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIC8vIFJlbG9hZCBwYWdlXG4gICAgICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKG1vZGVsLCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJvcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuXG5cbiAgICByZW5kZXJDbWFwOiBmdW5jdGlvbihwYWlycywgY2x1c3QsIG51bUNsdXN0ZXJzLCBzdmdJRCwgaGVpZ2h0LCB3aWR0aCwgY29sb3JzKSAge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgdmFyIHN2Z0hlaWdodCA9IGhlaWdodCAvIDI7XG4gICAgICB2YXIgc3ZnV2lkdGggPSB3aWR0aCAvIDI7XG4gICAgICB2YXIgbWFyZ2luID0ge3RvcDogMCwgcmlnaHQ6IDAsIGJvdHRvbTogMCwgbGVmdDogMH07XG5cbiAgICAgIC8qKlxuICAgICAgICogQ2xvc3VyZVxuICAgICAgICogQHBhcmFtICB7W3R5cGVdfSBjdXJyZW50Q2x1c3RlciBbZGVzY3JpcHRpb25dXG4gICAgICAgKiBAcmV0dXJuIHtbdHlwZV19ICAgICAgICAgICAgICAgIFtkZXNjcmlwdGlvbl1cbiAgICAgICAqL1xuICAgICAgZnVuY3Rpb24gcnVuU2ltdWxhdGlvbihjdXJyZW50Q2x1c3RlciwgY2x1c3RlckluZGV4KSB7XG4gICAgICAgIC8vIFNhdmUgdGVtcG9yYXJ5IGNsdXN0ZXJcbiAgICAgICAgdmFyIGNsdXN0ZXIgPSBjdXJyZW50Q2x1c3RlcjtcblxuICAgICAgICAvLyBHZXQgZGF0YSBmb3IgZm9yY2Ugc2ltdWxhdGlvbiB3aXRoXG4gICAgICAgIC8vIG5vZGVzIGFuZCBsaW5rc1xuICAgICAgICB2YXIgZ3JhcGggPSBhcHAuZ2V0TGlua3NOb2RlcyhjbHVzdGVyKTtcblxuICAgICAgICAvLyBDcmVhdGUgc3ZnXG4gICAgICAgIHZhciBzdmcgPSBkMy5zZWxlY3Qoc3ZnSUQpLmFwcGVuZChcInN2Z1wiKTtcbiAgICAgICAgICAvLyAuYXR0cihcIndpZHRoXCIsIHN2Z1dpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQpXG4gICAgICAgICAgLy8gLmF0dHIoXCJoZWlnaHRcIiwgc3ZnSGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b20pO1xuXG4gICAgICAgIC8vIENyZWF0ZSBmb3JjZSBzaW11bGF0aW9uXG4gICAgICAgIHZhciBzaW11bGF0aW9uID0gZDMuZm9yY2VTaW11bGF0aW9uKGdyYXBoLm5vZGVzKVxuICAgICAgICAgIC5mb3JjZSgnY2hhcmdlJywgZDMuZm9yY2VNYW55Qm9keSgpLnN0cmVuZ3RoKC0yNDApKVxuICAgICAgICAgIC5mb3JjZSgnbGluaycsIGQzLmZvcmNlTGluayhncmFwaC5saW5rcylcbiAgICAgICAgICAgIC5kaXN0YW5jZSgyMDApXG4gICAgICAgICAgICAuaWQoZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICByZXR1cm4gZC5pZDtcbiAgICAgICAgICAgIH0pKVxuICAgICAgICAgIC8vIC5mb3JjZShcImNvbGxpZGVcIiwgZDMuZm9yY2VDb2xsaWRlKCkucmFkaXVzKGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuciArIDEuNTsgfSkuaXRlcmF0aW9ucygyKSlcbiAgICAgICAgICAuZm9yY2UoJ2NlbnRlcicsIGQzLmZvcmNlQ2VudGVyKHN2Z1dpZHRoIC8gMiwgc3ZnSGVpZ2h0IC8gMikpXG4gICAgICAgICAgLmZvcmNlKCd4JywgZDMuZm9yY2VYKCkpXG4gICAgICAgICAgLmZvcmNlKCd5JywgZDMuZm9yY2VZKCkpXG4gICAgICAgICAgLnN0b3AoKTtcblxuICAgICAgICAvLyBXcmFwIGV2ZXJ5dGhpbmcgaW4gZyBlbGVtZW50XG4gICAgICAgIHZhciBnID0gc3ZnLmFwcGVuZCgnZycpO1xuXG4gICAgICAgIC8vIFN0b3JlcyBhbGwgbGlua3NcbiAgICAgICAgdmFyIGxpbmtlZEJ5SW5kZXggPSB7fTtcblxuICAgICAgICAvLyBDYWxsIHpvb21cbiAgICAgICAgc3ZnLmNhbGwoZDMuem9vbSgpXG4gICAgICAgICAgLnNjYWxlRXh0ZW50KFsxIC8gMTAsIDEwXSlcbiAgICAgICAgICAub24oJ3pvb20nLCB6b29tZWQpKTtcblxuICAgICAgICB2YXIgbG9hZGluZyA9IHN2Zy5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgICAgICAgLmF0dHIoXCJkeVwiLCBcIjAuMzVlbVwiKVxuICAgICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAgICAgICAuYXR0cihcImZvbnQtZmFtaWx5XCIsIFwic2Fucy1zZXJpZlwiKVxuICAgICAgICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIDEwKVxuICAgICAgICAgIC5hdHRyKCd4Jywgc3ZnV2lkdGggLyAyKVxuICAgICAgICAgIC5hdHRyKCd5Jywgc3ZnSGVpZ2h0IC8gMilcbiAgICAgICAgICAudGV4dChcIlNpbXVsYXRpbmcuIE9uZSBtb21lbnQgcGxlYXNl4oCmXCIpO1xuXG4gICAgICAgIC8vIFJ1biBzaW11bGF0aW9uIGluIHRoZSBiYWNrZ3JvdW5kXG4gICAgICAgIGQzLnRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbG9hZGluZy5yZW1vdmUoKTtcblxuICAgICAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vZDMvZDMtZm9yY2UvYmxvYi9tYXN0ZXIvUkVBRE1FLm1kI3NpbXVsYXRpb25fdGlja1xuICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gTWF0aC5jZWlsKE1hdGgubG9nKHNpbXVsYXRpb24uYWxwaGFNaW4oKSkgLyBNYXRoLmxvZygxIC0gc2ltdWxhdGlvbi5hbHBoYURlY2F5KCkpKTsgaSA8IG47ICsraSkge1xuICAgICAgICAgICAgc2ltdWxhdGlvbi50aWNrKCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gQWRkIGxpbmtzXG4gICAgICAgICAgdmFyIGxpbmsgPSBnLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnbGlua3MnKVxuICAgICAgICAgICAgLnNlbGVjdEFsbCgnbGluZScpXG4gICAgICAgICAgICAuZGF0YShncmFwaC5saW5rcylcbiAgICAgICAgICAgIC5lbnRlcigpLmFwcGVuZCgnbGluZScpXG4gICAgICAgICAgICAuYXR0cihcIngxXCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuc291cmNlLng7IH0pXG4gICAgICAgICAgICAuYXR0cihcInkxXCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuc291cmNlLnk7IH0pXG4gICAgICAgICAgICAuYXR0cihcIngyXCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQudGFyZ2V0Lng7IH0pXG4gICAgICAgICAgICAuYXR0cihcInkyXCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQudGFyZ2V0Lnk7IH0pO1xuXG4gICAgICAgICAgbGluay5lYWNoKGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgIGxpbmtlZEJ5SW5kZXhbZC5zb3VyY2UuaW5kZXggKyBcIixcIiArIGQudGFyZ2V0LmluZGV4XSA9IHRydWU7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICAvLyBBZGQgZGF0YSBvZiBzaW11bGF0aW9uIGdsb2JhbGx5XG4gICAgICAgICAgc2VsZi5zaW11bGF0aW9uc1tjbHVzdGVySW5kZXhdID0geydzaW11bGF0aW9uJzogc2ltdWxhdGlvbiwgJ2xpbmtlZEJ5SW5kZXgnOiBsaW5rZWRCeUluZGV4LCAnc3ZnJzogc3ZnfTtcblxuICAgICAgICAgIC8vIENyZWF0ZSBnIGVsZW1lbnQgdGhhdCBzdG9yZXNcbiAgICAgICAgICAvLyBjaXJjbGVzIGFuZCB0ZXh0IGFuZCBjYWxsIGRyYWdnaW5nIG9uIGl0XG4gICAgICAgICAgdmFyIG5vZGUgPSBnLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnbm9kZXMnKVxuICAgICAgICAgICAgLnNlbGVjdEFsbCgnLm5vZGUnKVxuICAgICAgICAgICAgLmRhdGEoZ3JhcGgubm9kZXMpXG4gICAgICAgICAgICAuZW50ZXIoKS5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgLmF0dHIoJ2lkJywgZnVuY3Rpb24oZCwgaSkge1xuICAgICAgICAgICAgICByZXR1cm4gJ25vZGUtJyArIGQuaWQ7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ25vZGUnKVxuICAgICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuICd0cmFuc2xhdGUoJyArIGQueCArICcsJyArIGQueSArICcpJztcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAub24oJ21vdXNlb3ZlcicsIG1vdXNlb3ZlcilcbiAgICAgICAgICAgIC5vbignbW91c2VvdXQnLCBtb3VzZW91dCk7XG5cbiAgICAgICAgICAvLyBBcHBlbmQgY2lyY2xlXG4gICAgICAgICAgdmFyIGNpcmNsZSA9IG5vZGUuYXBwZW5kKCdjaXJjbGUnKVxuICAgICAgICAgICAgLmF0dHIoJ3InLCAxMClcbiAgICAgICAgICAgIC5hdHRyKCdjeCcsIDApXG4gICAgICAgICAgICAuYXR0cignY3knLCAwKVxuICAgICAgICAgICAgLmF0dHIoJ2ZpbGwnLCAnI2NjYycpO1xuXG4gICAgICAgICAgLy8gQXBwZW5kIGxhYmVsIHRvIG5vZGUgY29udGFpbmVyXG4gICAgICAgICAgdmFyIGxhYmVsID0gbm9kZS5hcHBlbmQoJ3RleHQnKVxuICAgICAgICAgICAgLmF0dHIoJ2R5JywgLTEwKVxuICAgICAgICAgICAgLmF0dHIoJ2R4JywgMTIpXG4gICAgICAgICAgICAuc3R5bGUoJ29wYWNpdHknLCAwLjgpXG4gICAgICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCAnc3RhcnQnKVxuICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICByZXR1cm4gZC5pZDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBmdW5jdGlvbiBtb3VzZW92ZXIobW91c2VPdmVyT2JqZWN0KSB7XG4gICAgICAgICAgLy8gR2V0IGRhdGFcbiAgICAgICAgICB2YXIgbW91c2UgPSBkMy5tb3VzZSh0aGlzKTtcblxuICAgICAgICAgIC8vIFNlbGVjdCBlbGVtZW50IHRoYXQgaXMgaG92ZXJlZFxuICAgICAgICAgIHZhciBub2RlU2VsZWN0ZWQgPSBnLnNlbGVjdCgnI25vZGUtJyArIG1vdXNlT3Zlck9iamVjdC5pZCk7XG4gICAgICAgICAgdmFyIG5vZGVEYXRhID0gbm9kZVNlbGVjdGVkLmRhdGEoKVswXTtcblxuICAgICAgICAgIC8vIENoYW5nZSB0ZXh0IG9mIHNlbGVjdGVkIGVsZW1lbnRcbiAgICAgICAgICB2YXIgdGV4dFNlbGVjdGVkID0gbm9kZVNlbGVjdGVkLnNlbGVjdCgndGV4dCcpXG4gICAgICAgICAgICAuc3R5bGUoJ29wYWNpdHknLCAxKVxuICAgICAgICAgICAgLnN0eWxlKCdmb250LXdlaWdodCcsICdib2xkJyk7XG5cbiAgICAgICAgICAvLyBIaWdobGlnaHQgYWRqYWNlbnQgbm9kZXNcbiAgICAgICAgICBzdmcuc2VsZWN0QWxsKCd0ZXh0JylcbiAgICAgICAgICAgIC5zdHlsZSgnb3BhY2l0eScsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICBpZiAoaXNDb25uZWN0ZWQobm9kZURhdGEsIGQpKSB7XG4gICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICByZXR1cm4gMC4xO1xuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgIHN2Zy5zZWxlY3RBbGwoJ2NpcmNsZScpXG4gICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgIGlmIChpc0Nvbm5lY3RlZChub2RlRGF0YSwgZCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJyMwMDAnO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgcmV0dXJuICcjZjRmNGY0JztcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuc3R5bGUoJ29wYWNpdHknLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgIGlmIChpc0Nvbm5lY3RlZChub2RlRGF0YSwgZCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHJldHVybiAwLjI7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgICAgICAgIC8vIEhpZ2hsaWdodCBsaW5rcyAvL1xuICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgICAgICAgIHN2Zy5zZWxlY3RBbGwoJ2xpbmUnKVxuICAgICAgICAgICAgLnN0eWxlKCdzdHJva2UnLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgIHJldHVybiBkLnNvdXJjZS5pZCA9PT0gbm9kZURhdGEuaWQgfHwgZC50YXJnZXQuaWQgPT09IG5vZGVEYXRhLmlkID8gJyM0YzRjNGMnIDogJyNmNGY0ZjQnO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgICAgICAgIC8vIEhpZ2hsaWdodCB3b3JkcyBpbiB0ZXh0IC8vXG4gICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICAgIC8vIFdlIG5lZWQgdG8gZ2V0IHRoZSB0ZXh0IG9mIHRoZSBzZWxlY3RlZCB3b3JkIGluIG9yZGVyXG4gICAgICAgICAgLy8gdG8gaGlnaGxpZ2h0IHRoZW1cbiAgICAgICAgICB2YXIgd29yZFNlbGVjdGVkID0gdGV4dFNlbGVjdGVkLnRleHQoKTtcblxuICAgICAgICAgIC8vIEdldCBhbGwgd29yZHMgdGhhdCBhcmUgc2VtYW50aWNhbGx5IHJlbGF0ZWRcbiAgICAgICAgICAvLyB0byB0aGUgc2VsZWN0ZWQgd29yZFxuICAgICAgICAgIHZhciB3b3Jkc1JlbGF0ZWQgPSBbXTtcblxuICAgICAgICAgIHN2Zy5zZWxlY3RBbGwoJ3RleHQnKVxuICAgICAgICAgICAuZWFjaChmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgaWYgKGlzQ29ubmVjdGVkKG5vZGVEYXRhLCBkKSkge1xuICAgICAgICAgICAgICAgd29yZHNSZWxhdGVkLnB1c2goZCk7XG4gICAgICAgICAgICAgfVxuICAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIEdldCBhbGwgd29yZHMgYW5kIGNvcnJlc3BvbmRpbmcgb3J0aG9Gb3Jtc1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHNlbGYuYW5hbHl6ZXIudG9KU09OKCkpO1xuICAgICAgICAgIHZhciBsZW1tYVdvcmRSZWxhdGlvbnMgPSBzZWxmLmFuYWx5emVyLmdldCgnbGVtbWFXb3JkUmVsYXRpb25zJyk7XG4gICAgICAgICAgdmFyIG9ydGhvcyA9IHdvcmRzUmVsYXRlZC5tYXAoZnVuY3Rpb24ob2JqKSB7XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5hbmFseXplci5nZXQoJ2xlbW1hV29yZFJlbGF0aW9ucycpW29iai5pZF07XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBvcnRob3MgPSBbXS5jb25jYXQuYXBwbHkoW10sIG9ydGhvcyk7XG5cbiAgICAgICAgICBhcHAuaGlnaGxpZ2h0U2VsZWN0ZWRXb3JkKCcjZWRpdG9yLWZ1bGwtbWVkaXVtLWVkaXRvcicsIG9ydGhvcyk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpc0Nvbm5lY3RlZChhLCBiKSB7XG4gICAgICAgICAgcmV0dXJuIGlzQ29ubmVjdGVkQXNUYXJnZXQoYSwgYikgfHwgaXNDb25uZWN0ZWRBc1NvdXJjZShhLCBiKSB8fCBhLmluZGV4ID09IGIuaW5kZXg7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpc0Nvbm5lY3RlZEFzU291cmNlKGEsIGIpIHtcbiAgICAgICAgICByZXR1cm4gbGlua2VkQnlJbmRleFthLmluZGV4ICsgXCIsXCIgKyBiLmluZGV4XTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGlzQ29ubmVjdGVkQXNUYXJnZXQoYSwgYikge1xuICAgICAgICAgIHJldHVybiBsaW5rZWRCeUluZGV4W2IuaW5kZXggKyBcIixcIiArIGEuaW5kZXhdO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gem9vbWVkKCkge1xuICAgICAgICAgIGcuYXR0cigndHJhbnNmb3JtJywgZDMuZXZlbnQudHJhbnNmb3JtKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBTdG9yZSBjbHVzdGVycyB0ZW1wb3JhcmlseVxuICAgICAgdmFyIGNsdXN0ZXJzID0gdGhpcy5hbmFseXplci5nZXQoJ2NsdXN0ZXJzJyk7XG5cbiAgICAgIC8vIENyZWF0ZSBzdmcgZm9yIGVhY2ggY2x1c3RlclxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjbHVzdGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICBydW5TaW11bGF0aW9uKGNsdXN0ZXJzW2ldLCBpKTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gbW91c2VvdXQoKSB7XG4gICAgICAgICQoJyNlZGl0b3ItZnVsbC1tZWRpdW0tZWRpdG9yJykuZmluZCgncCcpLmVhY2goZnVuY3Rpb24ocGFyYWdyYXBoKSB7XG4gICAgICAgICAgdmFyIHRleHRQYXJhZ3JhcGggPSAkKHRoaXMpLnRleHQoKTtcbiAgICAgICAgICAvLyBXcmFwIGV2ZXJ5dGhpbmcgaW4gc3BhbiBlbGVtZW50c1xuICAgICAgICAgIHZhciBzcGFuVGV4dCA9IHRleHRQYXJhZ3JhcGgucmVwbGFjZSgvKFtBLXowLTknPD5cXHUwMGRjXFx1MDBmY1xcdTAwZTRcXHUwMGM0XFx1MDBmNlxcdTAwZDZcXHUwMGRmXFwtL10rKS9nLCAnPHNwYW4+JDE8L3NwYW4+Jyk7XG5cbiAgICAgICAgICB2YXIganF1ZXJ5U3BhbiA9ICQoc3BhblRleHQpO1xuXG4gICAgICAgICAgLy8gR2VuZXJhdGUgc3BhbnMgZm9yIHRleHRcbiAgICAgICAgICAkKHRoaXMpLmh0bWwoanF1ZXJ5U3Bhbik7XG4gICAgICAgICAgJCh0aGlzKS5hcHBlbmQoJy4nKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gR2V0IGFsbCBub2Rlc1xuICAgICAgICB2YXIgbm9kZXMgPSBkMy5zZWxlY3RBbGwoJy5ub2RlJyk7XG5cbiAgICAgICAgbm9kZXMuc2VsZWN0QWxsKCd0ZXh0JylcbiAgICAgICAgICAgLnN0eWxlKCdvcGFjaXR5JywgMC44KVxuICAgICAgICAgICAuc3R5bGUoJ2ZvbnQtd2VpZ2h0JywgJ25vcm1hbCcpO1xuXG4gICAgICAgIGQzLnNlbGVjdEFsbCgnY2lyY2xlJylcbiAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCAnI2NjYycpXG4gICAgICAgICAgLnN0eWxlKCdvcGFjaXR5JywgMSk7XG5cbiAgICAgICAgZDMuc2VsZWN0QWxsKCcubGlua3MnKS5zZWxlY3RBbGwoJ2xpbmUnKVxuICAgICAgICAgLnN0eWxlKCdzdHJva2UnLCAnI2NjYycpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBvblRleHRIb3ZlcjogZnVuY3Rpb24oZSkge1xuICAgICAgLy8gR2V0IHNwYW4gZWxlbWVudCB0aGF0IGlzIGhvdmVyZWRcbiAgICAgIHZhciBob3ZlcmVkRWxlbWVudCA9IGUuY3VycmVudFRhcmdldC5pbm5lclRleHQ7XG5cbiAgICAgIC8vIEdldCBsZW1tYXMgZm9yIHdvcmRcbiAgICAgIHZhciBsZW1tYXNGb3JXb3JkID0gdGhpcy5hbmFseXplci5nZXQoJ3dvcmRMZW1tYVJlbGF0aW9ucycpW2hvdmVyZWRFbGVtZW50XTtcblxuICAgICAgLy8gSXMgZWxlbWVudCBpbiBEYXRhP1xuICAgICAgaWYgKGxlbW1hc0ZvcldvcmQpIHtcbiAgICAgICAgLy8gR2V0IGNsdXN0ZXIgb2Ygd29yZFxuXG4gICAgICAgIC8vIExvb3Agb3ZlciBldmVyeSBjbHVzdGVyIGFuZCBzZWUgaW4gd2hpY2ggY2x1c3RlciB0aGUgd29yZCBpc1xuICAgICAgICB2YXIgY2x1c3RlcnMgPSB0aGlzLmFuYWx5emVyLmdldCgnY2x1c3RlcnMnKTtcbiAgICAgICAgdmFyIGluZGV4T2ZDbHVzdGVyID0gbnVsbDtcblxuICAgICAgICBmb3IgKHZhciBrZXkgaW4gY2x1c3RlcnMpIHtcbiAgICAgICAgICBjbHVzdGVyc1trZXldLm1hcChmdW5jdGlvbihkLCBpKSB7XG4gICAgICAgICAgICB2YXIgc291cmNlID0gZC5zb3VyY2Uud29yZDtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBkLnRhcmdldC53b3JkO1xuXG4gICAgICAgICAgICBpZiAoaG92ZXJlZEVsZW1lbnQgPT0gc291cmNlIHx8IGhvdmVyZWRFbGVtZW50ID09IHRhcmdldCkge1xuICAgICAgICAgICAgICBpbmRleE9mQ2x1c3RlciA9IGtleTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBsaW5rZWRCeUluZGV4ID0gdGhpcy5zaW11bGF0aW9uc1tpbmRleE9mQ2x1c3Rlcl0ubGlua2VkQnlJbmRleDtcbiAgICAgICAgdmFyIHN2ZyA9IHRoaXMuc2ltdWxhdGlvbnNbaW5kZXhPZkNsdXN0ZXJdLnN2ZztcblxuICAgICAgICAvLyBHZXQgc2VsZWN0ZWQgd29yZFxuICAgICAgICB2YXIgbm9kZVNlbGVjdGVkID0gZDMuc2VsZWN0KCcjbm9kZS0nICsgbGVtbWFzRm9yV29yZFswXSk7XG4gICAgICAgIHZhciBub2RlRGF0YSA9IG5vZGVTZWxlY3RlZC5kYXRhKClbMF07XG5cbiAgICAgICAgLy8gQ2hhbmdlIHRleHQgb2Ygc2VsZWN0ZWQgZWxlbWVudFxuICAgICAgICB2YXIgdGV4dFNlbGVjdGVkID0gbm9kZVNlbGVjdGVkLnNlbGVjdCgndGV4dCcpXG4gICAgICAgICAgLnN0eWxlKCdvcGFjaXR5JywgMSlcbiAgICAgICAgICAuc3R5bGUoJ2ZvbnQtd2VpZ2h0JywgJ2JvbGQnKTtcblxuICAgICAgICAvLyBIaWdobGlnaHQgYWRqYWNlbnQgbm9kZXNcbiAgICAgICAgc3ZnLnNlbGVjdEFsbCgndGV4dCcpXG4gICAgICAgICAgLnN0eWxlKCdvcGFjaXR5JywgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICBpZiAoaXNDb25uZWN0ZWQobm9kZURhdGEsIGQpKSB7XG4gICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgIH1cblxuICAgICAgICAgICByZXR1cm4gMC4xO1xuXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgc3ZnLnNlbGVjdEFsbCgnY2lyY2xlJylcbiAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICBpZiAoaXNDb25uZWN0ZWQobm9kZURhdGEsIGQpKSB7XG4gICAgICAgICAgICAgIHJldHVybiAnIzAwMCc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiAnI2Y0ZjRmNCc7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuc3R5bGUoJ29wYWNpdHknLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICBpZiAoaXNDb25uZWN0ZWQobm9kZURhdGEsIGQpKSB7XG4gICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gMC4yO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgICAgICAvLyBIaWdobGlnaHQgbGlua3MgLy9cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgICAgIHN2Zy5zZWxlY3RBbGwoJ2xpbmUnKVxuICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlJywgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgcmV0dXJuIGQuc291cmNlLmlkID09PSBub2RlRGF0YS5pZCB8fCBkLnRhcmdldC5pZCA9PT0gbm9kZURhdGEuaWQgPyAnIzRjNGM0YycgOiAnI2Y0ZjRmNCc7XG4gICAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGlzQ29ubmVjdGVkKGEsIGIpIHtcbiAgICAgICAgcmV0dXJuIGlzQ29ubmVjdGVkQXNUYXJnZXQoYSwgYikgfHwgaXNDb25uZWN0ZWRBc1NvdXJjZShhLCBiKSB8fCBhLmluZGV4ID09IGIuaW5kZXg7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGlzQ29ubmVjdGVkQXNTb3VyY2UoYSwgYikge1xuICAgICAgICByZXR1cm4gbGlua2VkQnlJbmRleFthLmluZGV4ICsgXCIsXCIgKyBiLmluZGV4XTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gaXNDb25uZWN0ZWRBc1RhcmdldChhLCBiKSB7XG4gICAgICAgIHJldHVybiBsaW5rZWRCeUluZGV4W2IuaW5kZXggKyBcIixcIiArIGEuaW5kZXhdO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBvblRleHRIb3Zlck9mZjogZnVuY3Rpb24oZSkge1xuICAgICAgLy8gdmFyIGdFbGVtZW50ID0gZDMuc2VsZWN0QWxsKCdnJyk7XG5cbiAgICAgIC8vIGdFbGVtZW50LnNlbGVjdCgnY2lyY2xlJylcbiAgICAgIC8vICAgLnN0eWxlKCdmaWxsJywgJyNjY2MnKTtcblxuICAgICAgLy8gZ0VsZW1lbnQuc2VsZWN0KCd0ZXh0JylcbiAgICAgIC8vICAgLnN0eWxlKCdmb250LXdlaWdodCcsICdub3JtYWwnKTtcblxuICAgICAgZDMuc2VsZWN0QWxsKCd0ZXh0JylcbiAgICAgICAgIC5zdHlsZSgnb3BhY2l0eScsIDAuOClcbiAgICAgICAgIC5zdHlsZSgnZm9udC13ZWlnaHQnLCAnbm9ybWFsJyk7XG5cbiAgICAgIGQzLnNlbGVjdEFsbCgnY2lyY2xlJylcbiAgICAgICAgLnN0eWxlKCdmaWxsJywgJyNjY2MnKVxuICAgICAgICAuc3R5bGUoJ29wYWNpdHknLCAxKTtcblxuICAgICAgZDMuc2VsZWN0QWxsKCcubGlua3MnKS5zZWxlY3RBbGwoJ2xpbmUnKVxuICAgICAgIC5zdHlsZSgnc3Ryb2tlJywgJyNjY2MnKTtcbiAgICB9LFxuXG5cbn0pO1xuXG5uZXcgYXBwLkNtYXBWaWV3KCk7XG4iXSwiZmlsZSI6ImNtYXAtaW50ZWdyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9\n"],"sourceRoot":"/source/"}